<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dokumentation - 2&nbsp; Environmental Impact</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./meat-consumption.html" rel="next">
<link href="./intro.html" rel="prev">
<link href=".//images/LogoFavicon.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Dokumentation - 2&nbsp; Environmental Impact">
<meta property="og:description" content="">
<meta property="og:image" content="https://Katharina020201.github.io/dst-documentation/images/volume.png">
<meta property="og:site-name" content="Dokumentation">
<meta property="og:image:height" content="846">
<meta property="og:image:width" content="726">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./impact-data.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environmental Impact</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Dokumentation</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Katharina020201/dst-documentation" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Urban Butcher</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./impact-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environmental Impact</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meat-consumption.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Meat Consumption</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./alt-protein.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Alt-Protein Companies</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-story.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The Story</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./learnings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learnings</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#about-the-data-poore-2018" id="toc-about-the-data-poore-2018" class="nav-link active" data-scroll-target="#about-the-data-poore-2018"><span class="header-section-number">2.1</span> About the Data <span class="citation" data-cites="poore-2018">(Poore and Nemecek 2018)</span></a></li>
  <li><a href="#explorative-data-analysis" id="toc-explorative-data-analysis" class="nav-link" data-scroll-target="#explorative-data-analysis"><span class="header-section-number">2.2</span> Explorative Data Analysis</a></li>
  <li><a href="#first-visualization-ideas" id="toc-first-visualization-ideas" class="nav-link" data-scroll-target="#first-visualization-ideas"><span class="header-section-number">2.3</span> First Visualization ideas</a>
  <ul class="collapse">
  <li><a href="#pie-chart" id="toc-pie-chart" class="nav-link" data-scroll-target="#pie-chart"><span class="header-section-number">2.3.1</span> Pie Chart</a></li>
  <li><a href="#proportional-area-chart" id="toc-proportional-area-chart" class="nav-link" data-scroll-target="#proportional-area-chart"><span class="header-section-number">2.3.2</span> Proportional Area Chart</a></li>
  <li><a href="#bar-chart" id="toc-bar-chart" class="nav-link" data-scroll-target="#bar-chart"><span class="header-section-number">2.3.3</span> Bar Chart</a></li>
  <li><a href="#ridgeline-chart" id="toc-ridgeline-chart" class="nav-link" data-scroll-target="#ridgeline-chart"><span class="header-section-number">2.3.4</span> Ridgeline Chart</a></li>
  </ul></li>
  <li><a href="#pie-chart-for-introduction-of-the-problem" id="toc-pie-chart-for-introduction-of-the-problem" class="nav-link" data-scroll-target="#pie-chart-for-introduction-of-the-problem"><span class="header-section-number">2.4</span> Pie Chart for Introduction of the Problem</a></li>
  <li><a href="#bar-chart-comparing-the-impact-types" id="toc-bar-chart-comparing-the-impact-types" class="nav-link" data-scroll-target="#bar-chart-comparing-the-impact-types"><span class="header-section-number">2.5</span> Bar Chart comparing the Impact Types</a></li>
  <li><a href="#range-bar-chart-for-comparing-ghg-emissions-and-protein" id="toc-range-bar-chart-for-comparing-ghg-emissions-and-protein" class="nav-link" data-scroll-target="#range-bar-chart-for-comparing-ghg-emissions-and-protein"><span class="header-section-number">2.6</span> Range Bar Chart for comparing GHG emissions and Protein</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Katharina020201/dst-documentation/edit/main/impact-data.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/Katharina020201/dst-documentation/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Environmental Impact</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="about-the-data-poore-2018" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="about-the-data-poore-2018"><span class="header-section-number">2.1</span> About the Data <span class="citation" data-cites="poore-2018">(<a href="#ref-poore-2018" role="doc-biblioref">Poore and Nemecek 2018</a>)</span></h2>
<p>This dataset covers data from approx. 38,700 commercially viable farms in 119 countries and 40 products, representing ~90% of global protein and calorie consumption.</p>
<p>The meta-analysis contains six important environmental impact indicators:</p>
<ul>
<li>land use</li>
<li>freshwater withdrawals weighted by local water scarcity</li>
<li>water use</li>
<li>GHG (greenhouse gas)</li>
<li>acidifying</li>
<li>eutrophying emissions (runoff of excess nutrients into the surrounding environment and waterways, which affect and pollute the ecosystems - measured in grams of phosphate equivalents, PO₄eq)</li>
</ul>
<p>Stress-weighted water use is the volume of blue water multiplied by a water-stress index. Its main application related to water use is the potential to contribute to water scarcity and thereby limit the availability of freshwater for human uses and for the environment.</p>
<p>→ Interesting for the Data-Story: Land Use, Freshwater Use &amp; GHG emissions</p>
<p><img src="images/volume.png" class="img-fluid" style="width:80.0%"></p>
<p>In this study from 2018, Poore &amp; Nemecek compared the mentioned environmental impact of different products based on either the mass of the product (Volume FU) or protein contained (Nutrition NU).</p>
<p>→ Comparing the products per 100g of protein could be an interesting metric, because most people consume meat or other animal products because of their nutritional value.</p>
</section>
<section id="explorative-data-analysis" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="explorative-data-analysis"><span class="header-section-number">2.2</span> Explorative Data Analysis</h2>
<p>Because this is a very complex (but well-known) data set I looked for already existing visualizations of the data to get an understanding of possible trends. I found very good visualization ideas on the “Our World in Data” Website.</p>
<p>See the example visualizations here: <a href="https://ourworldindata.org/environmental-impacts-of-food?country=&amp;insight=differences-carbon-footprint-foods#key-insights-on-the-environmental-impacts-of-food" target="_blank">Our World in Data</a></p>
</section>
<section id="first-visualization-ideas" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="first-visualization-ideas"><span class="header-section-number">2.3</span> First Visualization ideas</h2>
<section id="pie-chart" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="pie-chart"><span class="header-section-number">2.3.1</span> Pie Chart</h3>
<p><img src="images/pie-chart.png" class="img-fluid" style="width:60.0%"></p>
<p>Using this simple pie chart as a starting point, to give an overview over the overall impact of food on the climate.</p>
<p>Quote from the paper: “Today’s food supply chain creates ~13.7 billion metric tons of carbon dioxide equivalents (CO2eq), 26% of anthropogenic (man-made) GHG emissions.” <span class="citation" data-cites="poore-2018">(<a href="#ref-poore-2018" role="doc-biblioref">Poore and Nemecek 2018</a>)</span></p>
</section>
<section id="proportional-area-chart" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="proportional-area-chart"><span class="header-section-number">2.3.2</span> Proportional Area Chart</h3>
<p><img src="images/land-use.png" class="img-fluid" style="width:60.0%"></p>
<p>My initial idea was to visualize the land use with an proporional area chart.</p>
</section>
<section id="bar-chart" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="bar-chart"><span class="header-section-number">2.3.3</span> Bar Chart</h3>
<p><img src="images/ghg.png" class="img-fluid" style="width:60.0%"></p>
<p>To visualize the emissions per 1000 kcal, 1kg and 100g protein per product and highlighting the plant-based products.</p>
</section>
<section id="ridgeline-chart" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="ridgeline-chart"><span class="header-section-number">2.3.4</span> Ridgeline Chart</h3>
<p><img src="images/ridgeline.png" class="img-fluid" style="width:60.0%"></p>
<p>To visualize the distribution of ghg emissions (5th percentile, median,…) per product, I thought a ridgeline plot could be fitting. But because the values where so different (really big values compared to small values) the implementation was very difficult, so I later decided on an easier visualization which conveys the same message (range bar chart).</p>
</section>
</section>
<section id="pie-chart-for-introduction-of-the-problem" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="pie-chart-for-introduction-of-the-problem"><span class="header-section-number">2.4</span> Pie Chart for Introduction of the Problem</h2>
<p><strong>Implementataion:</strong></p>
<ol type="1">
<li>Creating a new df with own values out of the study</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df_food <span class="op">=</span> pd.DataFrame({<span class="st">"Category"</span>: [<span class="st">'non-food'</span>, <span class="st">'food'</span>], <span class="st">"Percent"</span>: [<span class="dv">74</span>, <span class="dv">26</span>], <span class="st">"Emissions"</span>: [<span class="st">'5,269.2 billion tons CO2eq'</span>, <span class="st">'13.7 billion tons CO2eq'</span>]})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><p>Colors for food and non-```python</p></li>
<li><p>Plotting the pie chart and saving the df</p></li>
</ol>
<p><strong>Final Chart:</strong></p>
<p><img src="images/visualization(3).svg" class="img-fluid" style="width:60.0%"></p>
</section>
<section id="bar-chart-comparing-the-impact-types" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="bar-chart-comparing-the-impact-types"><span class="header-section-number">2.5</span> Bar Chart comparing the Impact Types</h2>
<p><strong>Implementation:</strong></p>
<ol type="1">
<li><p>Importing the sheet “Weight”, cleaning the df, dropping some first and last rows with not relevant information</p></li>
<li><p>Defining an array with the names of the products I want to compare (otherwise there are too much, visualization will be cluttered)</p></li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>products_to_select <span class="op">=</span> [<span class="st">'Rice'</span>, <span class="st">'Potatoes'</span>, <span class="st">'Wheat'</span>, <span class="st">'Soymilk'</span>,<span class="st">'Tofu'</span>, <span class="st">'Bovine Meat (beef herd)'</span>, <span class="st">'Bovine Meat (dairy herd)'</span>, <span class="st">'Pig Meat'</span>, <span class="st">'Poultry Meat'</span>, <span class="st">'Milk'</span>, <span class="st">'Cheese'</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df_weight <span class="op">=</span> df_weight[df_weight[<span class="st">'Product'</span>].isin(products_to_select)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>The data table was not well structured for my analysis, there where no clear coloumn names</li>
</ol>
<p><img src="images/df_weight.png" class="img-fluid" style="width:60.0%"></p>
<p>With the help of GitHub Copilot I edited the columns to have a Impact Type Prefix, e.g.&nbsp;Land Use_5th pctl</p>
<ol start="4" type="1">
<li>Now I could select the median of the Impact Types I wanted to display</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_weight <span class="op">=</span> df_weight[[<span class="st">'Product'</span>, <span class="st">'Land Use_Median'</span>, <span class="st">'GHG_Median'</span>]]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_weight <span class="op">=</span> df_weight.rename(columns<span class="op">=</span>{<span class="st">'Land Use_Median'</span>: <span class="st">'Land Use'</span>, <span class="st">'GHG_Median'</span>: <span class="st">'Emissions'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="5" type="1">
<li>Creating a new column for the impact type and Product Type</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_weight2 <span class="op">=</span> df_weight.melt(id_vars<span class="op">=</span>[<span class="st">'Product'</span>],</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>             value_vars <span class="op">=</span>[<span class="st">'Land Use'</span>, <span class="st">'Emissions'</span>],</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>             var_name<span class="op">=</span><span class="st">'Impact Type'</span>,  <span class="co">#neuer Typ</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>             value_name<span class="op">=</span><span class="st">'Impact'</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>animal_products <span class="op">=</span> [<span class="st">'Bovine Meat (beef herd)'</span>, <span class="st">'Bovine Meat (dairy herd)'</span>, <span class="st">'Pig Meat'</span>, <span class="st">'Poultry Meat'</span>, <span class="st">'Cheese'</span>, <span class="st">'Milk'</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Help from CoPiliot</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column 'Product Type' that indicates whether each product is an animal product or a plant product</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>df_weight2[<span class="st">'Product Type'</span>] <span class="op">=</span> df_weight2[<span class="st">'Product'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Animal Products'</span> <span class="cf">if</span> x <span class="kw">in</span> animal_products <span class="cf">else</span> <span class="st">'Plants'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="6" type="1">
<li>Cleaned data set:</li>
</ol>
<table class="table">
<thead>
<tr class="header">
<th>Product</th>
<th>Impact Type</th>
<th>Impact</th>
<th>Product Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Rice</td>
<td>Land Use</td>
<td>2.15</td>
<td>Plants</td>
</tr>
<tr class="even">
<td>Potatoes</td>
<td>Land Use</td>
<td>0.82</td>
<td>Plants</td>
</tr>
<tr class="odd">
<td>Peas</td>
<td>Land Use</td>
<td>6.73</td>
<td>Plants</td>
</tr>
<tr class="even">
<td>Soymilk</td>
<td>Land Use</td>
<td>0.64</td>
<td>Plants</td>
</tr>
<tr class="odd">
<td>Tofu</td>
<td>Land Use</td>
<td>3.41</td>
<td>Plants</td>
</tr>
<tr class="even">
<td>Olive Oil</td>
<td>Land Use</td>
<td>17.29</td>
<td>Plants</td>
</tr>
<tr class="odd">
<td>Tomatoes</td>
<td>Land Use</td>
<td>0.17</td>
<td>Plants</td>
</tr>
<tr class="even">
<td>Bovine Meat (beef herd)</td>
<td>Land Use</td>
<td>170.37</td>
<td>Animal Products</td>
</tr>
<tr class="odd">
<td>Bovine Meat (dairy herd)</td>
<td>Land Use</td>
<td>25.94</td>
<td>Animal Products</td>
</tr>
<tr class="even">
<td>Lamb &amp; Mutton</td>
<td>Land Use</td>
<td>127.41</td>
<td>Animal Products</td>
</tr>
<tr class="odd">
<td>Pig Meat</td>
<td>Land Use</td>
<td>13.44</td>
<td>Animal Products</td>
</tr>
</tbody>
</table>
<ol start="7" type="1">
<li>Saving the data and plotting the bar chart</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>impact_chart <span class="op">=</span> alt.Chart(df_weight2).mark_bar().encode(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'Impact:Q'</span>, scale<span class="op">=</span>alt.Scale(domain<span class="op">=</span>[df_weight2[<span class="st">'Impact'</span>].<span class="bu">min</span>(), df_weight2[<span class="st">'Impact'</span>].<span class="bu">max</span>()])).sort(<span class="st">'-y'</span>).axis(   <span class="co"># - ist descending</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        labelAngle <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        titleAnchor <span class="op">=</span> <span class="st">'start'</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Impact Type:N'</span>, title<span class="op">=</span><span class="va">None</span>).axis(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> <span class="va">False</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        titleAnchor <span class="op">=</span> <span class="st">'end'</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        grid <span class="op">=</span> <span class="va">False</span>),       </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'Impact Type:N'</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>).facet(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    row<span class="op">=</span>alt.Row(<span class="st">'Product:N'</span>, sort<span class="op">=</span>product_order, title<span class="op">=</span><span class="va">None</span>, header<span class="op">=</span>alt.Header(labelAngle<span class="op">=</span><span class="dv">0</span>, labelAlign<span class="op">=</span> <span class="st">'left'</span>)),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    spacing <span class="op">=</span> <span class="dv">5</span>,  <span class="co"># Set facet label angle to 45 degrees</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Final Chart:</strong></p>
<p><img src="images/visualization(2).svg" class="img-fluid" style="width:60.0%"></p>
</section>
<section id="range-bar-chart-for-comparing-ghg-emissions-and-protein" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="range-bar-chart-for-comparing-ghg-emissions-and-protein"><span class="header-section-number">2.6</span> Range Bar Chart for comparing GHG emissions and Protein</h2>
<p><strong>Implementation:</strong></p>
<ol type="1">
<li><p>Importing the sheets “Nutritional Units” cleaning the df, dropping some first and last rows with not relevant information</p></li>
<li><p>Defining an array with the names of the products I want to compare</p></li>
<li><p>Repeating step 3 from the weight sheet - restructuring the coloumn names</p></li>
<li><p>Dropping all columns after number 7, because I only want to compare the GHG emissions</p></li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_nu <span class="op">=</span> df_nu.drop(df_nu.columns[<span class="dv">7</span>:], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="5" type="1">
<li>Having now this table with the percentiles of the ghg emissions:</li>
</ol>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Product</th>
<th>5th pctl</th>
<th>10th pctl</th>
<th>Mean</th>
<th>Median</th>
<th>90th pctl</th>
<th>95th pctl</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Wheat &amp; Rye (Bread)</td>
<td>0.265388</td>
<td>0.295291</td>
<td>0.586843</td>
<td>0.474708</td>
<td>0.863445</td>
<td>1.147522</td>
</tr>
<tr class="even">
<td>Maize (Meal)</td>
<td>0.145937</td>
<td>0.161415</td>
<td>0.375898</td>
<td>0.260918</td>
<td>0.510779</td>
<td>0.778331</td>
</tr>
<tr class="odd">
<td>Barley (Beer)</td>
<td>0.118</td>
<td>0.14</td>
<td>0.236</td>
<td>0.236</td>
<td>0.328</td>
<td>0.354</td>
</tr>
<tr class="even">
<td>Oatmeal</td>
<td>0.304994</td>
<td>0.324056</td>
<td>0.945482</td>
<td>0.987419</td>
<td>1.555471</td>
<td>1.639344</td>
</tr>
</tbody>
</table>
<ol start="6" type="1">
<li><p>Choosing which products to compare and dropping the rest</p></li>
<li><p>Creating new columns to visualize the animal VS plant products and to compare tofu and bovine meat</p></li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Help from CoPiliot</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column 'Product Type' that indicates whether each product is an animal product or a plant product</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>df_nu[<span class="st">'Product Type'</span>] <span class="op">=</span> df_nu[<span class="st">'Product'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Animal Products'</span> <span class="cf">if</span> x <span class="kw">in</span> animal_products <span class="cf">else</span> <span class="st">'Plants'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column 'Compare' to later define a scale and change the opacity of all the products that are "No" in the compare list</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>compare <span class="op">=</span> [<span class="st">'Bovine Meat (dairy herd)'</span> , <span class="st">'Tofu'</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>df_nu[<span class="st">'Compare'</span>] <span class="op">=</span> df_nu[<span class="st">'Product'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Yes'</span> <span class="cf">if</span> x <span class="kw">in</span> compare <span class="cf">else</span> <span class="st">'No'</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># scale for Product Type Colors</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>df_nu[<span class="st">'Product Type'</span>] <span class="op">=</span> df_nu[<span class="st">'Product Type'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>PRODUCT_TYPE_NU <span class="op">=</span> df_nu[<span class="st">'Product Type'</span>].cat.categories.to_list()</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>product_colors <span class="op">=</span> alt.Scale(</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    domain<span class="op">=</span>PRODUCT_TYPE_NU,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span><span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'green'</span>]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># scale for Comparison Opacity</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>COMPARE <span class="op">=</span> df_nu[<span class="st">'Compare'</span>].cat.categories.to_list()</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>product_opacity <span class="op">=</span> alt.Scale(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    domain<span class="op">=</span>COMPARE,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">range</span><span class="op">=</span>[<span class="fl">0.1</span>, <span class="dv">1</span>]</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="8" type="1">
<li>Plotting the range bar chart and showing median points</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>bar_nu <span class="op">=</span> alt.Chart(df_nu).mark_bar(cornerRadius<span class="op">=</span><span class="dv">10</span>, height<span class="op">=</span><span class="dv">20</span>).encode(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">'5th pctl:Q'</span>).scale(domain<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">140</span>]).title(<span class="st">'GHG Emissions (kg CO2eq/kg)'</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x2<span class="op">=</span><span class="st">'95th pctl:Q'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">'Product:N'</span>, title<span class="op">=</span><span class="st">'Product'</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>alt.Color(<span class="st">'Product Type:N'</span>, scale<span class="op">=</span>product_colors) </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>).properties(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">600</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># better use median!!! -&gt; corrected in the quarto presentation</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>mean_points <span class="op">=</span> alt.Chart(df_nu).mark_point(filled<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">'black'</span>, size<span class="op">=</span><span class="dv">200</span>).encode(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  x<span class="op">=</span>alt.X(<span class="st">'Mean:Q'</span>),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  y<span class="op">=</span>alt.Y(<span class="st">'Product:N'</span>),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Final Chart:</strong></p>
<p><img src="images/visualization(6).svg" class="img-fluid" style="width:60.0%"></p>
<p>Also: To focus the attention while comparing meat-protein and tofu-protein, I created a simple vertical line chart at the 5th percentile of bovine meat and gave the products which were not in comparison a lower opacity (see in 7, variable product_opacity).</p>
<p><img src="images/visualization(1).svg" class="img-fluid" style="width:60.0%"></p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-poore-2018" class="csl-entry" role="listitem">
Poore, Joseph, and Thomas Nemecek. 2018. <span>“<span class="nocase">Reducing food’s environmental impacts through producers and consumers</span>.”</span> <em>Science</em> 360 (6392): 987–92. <a href="https://doi.org/10.1126/science.aaq0216">https://doi.org/10.1126/science.aaq0216</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Urban Butcher</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./meat-consumption.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Meat Consumption</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>